<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Avatar POC - Claude Solution</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <h1>Avatar POC Room (Claude Solution)</h1>
    <video id="video" autoplay playsinline controls muted style="width:600px;"></video>

    <script src="https://cdn.jsdelivr.net/npm/livekit-client@latest/dist/livekit-client.umd.js"></script>
    <script>
        // EMBEDDED FRESH TOKEN - NO EXTERNAL FILES
        const livekitUrl = "wss://magic-mirror-q5ywtzo4.livekit.cloud";
        const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJBUEkyNnZqb01xRjhUUDkiLCJzdWIiOiJBUEkyNnZqb01xRjhUUDkiLCJpYXQiOjE3NTQyNDA4NzMsImV4cCI6MTc1NDI0NDQ3MywiaWRlbnRpdHkiOiJkZXZhbiIsInZpZGVvIjp7InJvb21Kb2luIjp0cnVlLCJyb29tIjoiZGVmYXVsdCJ9fQ.1jwL0DQrUOIQ42abSNA9zJ8e95MYowpuPJ2eqCuvdz0";
        
        console.log("üîë CLAUDE SOLUTION - FRESH TOKEN:", new Date().toLocaleTimeString());
        console.log("Token:", token.substring(0, 50) + "...");
        console.log("Token ends with:", token.substring(token.length - 20));
        
        async function connect() {
            try {
                console.log("üîó Attempting to connect to LiveKit...");
                console.log("URL:", livekitUrl);
                
                const { Room, LocalAudioTrack } = LivekitClient;
                const room = new Room();

                room.onTrackSubscribed = (track) => {
                    console.log("üìπ Track subscribed:", track.kind);
                    if (track.kind === "video") {
                        track.attach(document.getElementById("video"));
                        console.log("‚úÖ Video track attached to player");
                    }
                };

                room.onConnected = async () => {
                    console.log("‚úÖ Connected to LiveKit room");
                    
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        console.log("üé§ Microphone access granted");
                        
                        const audioTrack = await LocalAudioTrack.create(stream);
                        await room.localParticipant.publishTrack(audioTrack);
                        console.log("üì§ Audio track published to LiveKit");
                        
                    } catch (error) {
                        console.error("‚ùå Failed to access microphone:", error);
                    }
                };

                room.onDisconnected = (reason) => {
                    console.log("‚ùå Disconnected:", reason);
                };

                await room.connect(livekitUrl, token);
            } catch (error) {
                console.error("‚ùå Connection failed:", error);
            }
        }

        window.addEventListener('load', () => {
            if (typeof LivekitClient === 'undefined') {
                console.error('‚ùå LivekitClient global not found');
                return;
            }
            
            console.log('‚úÖ LivekitClient ready');
            connect();
        });
    </script>
</body>
</html> 